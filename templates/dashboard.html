<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- Bootstrap core css -->
    <link rel="stylesheet" href="../static/css/bootstrap.css">
    <!-- Custom styles for this template -->
    <link rel="stylesheet" href="../static/css/style.css">
    <!-- Responsive style -->
    <link rel="stylesheet" href="../static/css/responsive.css">
    <!-- Font Awesome -->
    <link href="../static/css/font-awesome.min.css" rel="stylesheet" />
    <!-- Dashboard specific styles -->
    <link rel="stylesheet" href="../static/css/dashboard.css">
    <style>
      /* Add this to your existing CSS file or within a <style> tag */
      .navbar-nav .nav-link.active {
          color: #ffbe33; /* Yellow color for active links */
      }
  
      .user_link.active i,
      .cart_link.active i {
          color: #ffbe33; /* Yellow color for active icons */
      }
  
      .user_link i,
      .cart_link i {
          color: #000; /* Default color for icons (black or any color you prefer) */
      }
  
      /* Additional styling for hover states if needed */
      .user_link:hover i,
      .cart_link:hover i {
          color: #ffbe33; /* Change to any color on hover if desired */
      }
  </style>
  

    <style>
      .modal {
          display: none;
          position: fixed;
          z-index: 1000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          overflow: auto;
          background-color: rgb(0,0,0);
          background-color: rgba(0,0,0,0.4);
      }
  
      .modal-content {
          background-color: #fefefe;
          margin: 15% auto;
          padding: 20px;
          border: 1px solid #888;
          width: 80%;
          z-index: 1001;
      }
  
      .close {
          color: #aaa;
          float: right;
          font-size: 28px;
          font-weight: bold;
      }
  
      .close:hover,
      .close:focus {
          color: black;
          text-decoration: none;
          cursor: pointer;
      }
  </style>
  
</head>
<body>

    <!-- Hero Section -->
    <div class="hero_area">
        <div class="bg-box">
            <img src="../static/images/bgim.jpg" alt="Background Image">
        </div>
        <!-- Header Section -->
        <header class="header_section">
            <div class="container">
                <nav class="navbar navbar-expand-lg custom_nav-container">
                    <a class="navbar-brand" href="{{ url_for('index') }}">
                        <span>MeatExpress</span>
                    </a>

                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class=""> </span>
                    </button>

                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mx-auto">
                            <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">Home</a></li>
                            <li class="nav-item"><a class="nav-link" href="{{ url_for('menu') }}">Menu</a></li>
                            <li class="nav-item"><a class="nav-link" href="{{ url_for('about') }}">About</a></li>
                            <li class="nav-item"><a class="nav-link" href="{{ url_for('book') }}">Bulk Order</a></li>
                        </ul>
                        <div class="user_option">
                            <a href="{{ url_for('dashboard') }}" class="user_link active">
                                <i class="fa fa-user" aria-hidden="true"></i>
                            </a>
                            <a class="cart_link active" href="#">
                              <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 456.029 456.029" style="enable-background:new 0 0 456.029 456.029;" xml:space="preserve">
                                <g>
                                  <g>
                                    <path d="M345.6,338.862c-29.184,0-53.248,23.552-53.248,53.248c0,29.184,23.552,53.248,53.248,53.248
                                 c29.184,0,53.248-23.552,53.248-53.248C398.336,362.926,374.784,338.862,345.6,338.862z" />
                                  </g>
                                </g>
                                <g>
                                  <g>
                                    <path d="M439.296,84.91c-1.024,0-2.56-0.512-4.096-0.512H112.64l-5.12-34.304C104.448,27.566,84.992,10.67,61.952,10.67H20.48
                                 C9.216,10.67,0,19.886,0,31.15c0,11.264,9.216,20.48,20.48,20.48h41.472c2.56,0,4.608,2.048,5.12,4.608l31.744,216.064
                                 c4.096,27.136,27.648,47.616,55.296,47.616h212.992c26.624,0,49.664-18.944,55.296-45.056l33.28-166.4
                                 C457.728,97.71,450.56,86.958,439.296,84.91z" />
                                  </g>
                                </g>
                                <g>
                                  <g>
                                    <path d="M215.04,389.55c-1.024-28.16-24.576-50.688-52.736-50.688c-29.696,1.536-52.224,26.112-51.2,55.296
                                 c1.024,28.16,24.064,50.688,52.224,50.688h1.024C193.536,443.31,216.576,418.734,215.04,389.55z" />
                                  </g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                                <g>
                                </g>
                              </svg>
                            </a>
                            <form class="form-inline">
                                <button class="btn my-2 my-sm-0 nav_search-btn" type="submit">
                                    <i class="fa fa-search" aria-hidden="true"></i>
                                </button>
                            </form>
                            <a href="{{ url_for('menu') }}" class="order_online">Order Online</a>
                        </div>
                    </div>
                </nav>
            </div>
        </header>
        <!-- End Header Section -->
    </div>

    <!-- Dashboard Section -->
    <section class="food_section layout_padding">
        <div class="dashboard-header">
            <h1>Welcome to Your Dashboard</h1>
        </div>

        <div class="dashboard-container">
            <div class="dashboard-section profile-details">
                <h2>Profile Details</h2>
                <p><strong>Name:</strong> {{ user.name }}</p>
                <p><strong>Email:</strong> {{ user.email }}</p>
                <p><strong>Phone:</strong> {{ user.phone }}</p>
                <p><a href="{{ url_for('index') }}">BACK TO HOME</a></p>
                <a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm">Logout</a>
            </div>

            <div class="dashboard-section order-history">
                <h2>Order History</h2>
                {% if orders %}
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in orders %}
                                <tr>
                                    <td>{{ order.item_name }}</td>
                                    <td>{{ order.quantity }}</td>
                                    <td>{{ order.price }}</td>
                                    <td>
                                        <form action="{{ url_for('delete_order', order_id=order.id) }}" method="post" style="display:inline;">
                                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>No orders found.</p>
                {% endif %}
            </div>
        </div>
    </section>

    
  <!-- footer section -->
  <!-- footer section -->
  <footer class="footer_section">
    <div class="container">
      <div class="row">
        <div class="col-md-4 footer-col">
          <div class="footer_contact">
            <h4>
              Contact Us
            </h4>
            <div class="contact_link_box">
              <a href="">
                <i class="fa fa-map-marker" aria-hidden="true"></i>
                <span>
                  Location
                </span>
              </a>
              <a href="">
                <i class="fa fa-phone" aria-hidden="true"></i>
                <span>
                  Call +91 1234567890
                </span>
              </a>
              <a href="">
                <i class="fa fa-envelope" aria-hidden="true"></i>
                <span>
                  meatexpress@gmail.com
                </span>
              </a>
            </div>
          </div>
        </div>
        <div class="col-md-4 footer-col">
          <div class="footer_detail">
            <a href="" class="footer-logo">
              MeatExpress
            </a>
            <p>
              We place a high priority on freshness, expert-butchering skills, and consistently pleasing our Customers.
            </p>
            <div class="footer_social">
              <a href="">
                <i class="fa fa-facebook" aria-hidden="true"></i>
              </a>
              <a href="">
                <i class="fa fa-twitter" aria-hidden="true"></i>
              </a>
              <a href="">
                <i class="fa fa-linkedin" aria-hidden="true"></i>
              </a>
              <a href="">
                <i class="fa fa-instagram" aria-hidden="true"></i>
              </a>
              <a href="">
                <i class="fa fa-pinterest" aria-hidden="true"></i>
              </a>
            </div>
          </div>
        </div>
        <div class="col-md-4 footer-col">
          <h4>
            Service Hours
          </h4>
          <p>
            Everyday
          </p>
          <p>
            06.00 Am -10.00 Pm
          </p>
        </div>
      </div>
      <div class="footer-info">
        <p>
          &copy; <span id="displayYear"></span> All Rights Reserved By
          <a href="https://html.design/">Meat Express</a><br><br>
        
        
        </p>
      </div>
    </div>
  </footer>
  <!-- footer section -->

  <!-- jQuery, Popper.js, and Bootstrap JS -->
  <script src="../static/js/jquery-3.6.0.min.js"></script>
  <script src="../static/js/popper.min.js"></script>
  <script src="../static/js/bootstrap.min.js"></script>

  <!-- Custom JS -->
  <script src="../static/js/custom.js"></script>


    <!-- Include JS files for Bootstrap and other functionalities -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <div id="cartModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Cart Items</h2>
        <ul id="cart-items"></ul>
        <h3>Total: ₹<span id="cart-total"></span></h3>
        <button id="checkout">Checkout</button>
      </div>
    </div>
  </div>
  
     <!--cart modal-->
  
     <div id="cartModal" class="modal">
      <div class="modal-content">
          <span class="close">&times;</span>
          <h2>Cart Items</h2>
          <ul id="cart-items"></ul>
          <p>Total: ₹<span id="cart-total"></span></p>
          <button id="checkout">Checkout</button>
      </div>
  </div>
  
  <div id="checkoutModal" class="modal">
      <div class="modal-content">
          <span class="close">&times;</span>
          <h2>Checkout</h2>
          <form id="checkout-form">
              <label for="address">Address:</label><br>
              <textarea id="address" name="address" required></textarea><br>
              <label for="mobile">Mobile Number:</label><br>
              <input type="text" id="mobile" name="mobile" required><br>
              <label for="payment-method">Payment Method:</label><br>
              <input type="radio" id="cod" name="payment-method" value="COD" checked> Cash on Delivery<br><br>
              <button type="submit">Submit Order</button>
          </form>
      </div>
  </div>   
   
  <!--cart script-->
  
  <script>
document.addEventListener('DOMContentLoaded', function() {
  var addToCartButtons = document.querySelectorAll('.add-to-cart');
  addToCartButtons.forEach(function(button) {
      button.addEventListener('click', function(event) {
          var name = button.getAttribute('data-name');
          var price = parseFloat(button.getAttribute('data-price'));
          addItemToCart(name, price);
      });
  });

  function addItemToCart(name, price) {
      var cart = JSON.parse(localStorage.getItem('cart')) || [];
      var found = false;
      for (var i = 0; i < cart.length; i++) {
          if (cart[i].name === name) {
              cart[i].quantity += 1;
              found = true;
              break;
          }
      }
      if (!found) {
          cart.push({ name: name, price: price, quantity: 1 });
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      alert('Item added to cart');
      updateCartItems();
  }

  var cartModal = document.getElementById("cartModal");
  var checkoutModal = document.getElementById("checkoutModal");
  var btn = document.querySelector(".cart_link");
  var cartClose = document.getElementsByClassName("close")[0];
  var checkoutClose = document.getElementsByClassName("close")[1];

  btn.onclick = function() {
      cartModal.style.display = "block";
      updateCartItems();
  }

  cartClose.onclick = function() {
      cartModal.style.display = "none";
  }

  checkoutClose.onclick = function() {
      checkoutModal.style.display = "none";
  }

  window.onclick = function(event) {
      if (event.target == cartModal || event.target == checkoutModal) {
          cartModal.style.display = "none";
          checkoutModal.style.display = "none";
      }
  }

  function updateCartItems() {
      var cartItems = JSON.parse(localStorage.getItem('cart')) || [];
      var cartItemsList = document.getElementById("cart-items");
      var cartTotal = document.getElementById("cart-total");

      cartItemsList.innerHTML = "";
      var total = 0;

      cartItems.forEach(function(item, index) {
          var li = document.createElement("li");
          li.innerHTML = item.name + " - ₹" + item.price + " x " + '<input type="number" value="' + item.quantity + '" min="1" data-index="' + index + '" class="quantity-input">' + ' <button class="remove-item" data-index="' + index + '">Remove</button>';
          cartItemsList.appendChild(li);
          total += item.price * item.quantity;
      });

      cartTotal.textContent = total;
      attachEventListeners();
  }

  function attachEventListeners() {
      var quantityInputs = document.querySelectorAll('.quantity-input');
      quantityInputs.forEach(function(input) {
          input.addEventListener('change', function(event) {
              var index = input.getAttribute('data-index');
              var cart = JSON.parse(localStorage.getItem('cart')) || [];
              cart[index].quantity = parseInt(event.target.value);
              localStorage.setItem('cart', JSON.stringify(cart));
              updateCartItems();
          });
      });

      var removeButtons = document.querySelectorAll('.remove-item');
      removeButtons.forEach(function(button) {
          button.addEventListener('click', function(event) {
              var index = button.getAttribute('data-index');
              var cart = JSON.parse(localStorage.getItem('cart')) || [];
              cart.splice(index, 1);
              localStorage.setItem('cart', JSON.stringify(cart));
              updateCartItems();
          });
      });

      var checkoutButton = document.getElementById('checkout');
      if (checkoutButton) {
          checkoutButton.removeEventListener('click', showCheckoutModal);
          checkoutButton.addEventListener('click', showCheckoutModal);
      }

      var checkoutForm = document.getElementById('checkout-form');
      if (checkoutForm) {
          checkoutForm.removeEventListener('submit', handleCheckoutFormSubmit);
          checkoutForm.addEventListener('submit', handleCheckoutFormSubmit);
      }
  }

  function showCheckoutModal() {
      cartModal.style.display = "none";
      checkoutModal.style.display = "block";
  }

  function handleCheckoutFormSubmit(event) {
      event.preventDefault();
      checkoutCart();
  }

  function checkoutCart() {
      var cart = JSON.parse(localStorage.getItem('cart')) || [];
      var address = document.getElementById('address').value;
      var mobile = document.getElementById('mobile').value;
      var paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;

      if (cart.length === 0) {
          alert('Your cart is empty');
          return;
      }

      if (!address || !mobile) {
          alert('Please provide your address and mobile number');
          return;
      }

      fetch('/place_order', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify({ cart: cart, address: address, mobile: mobile, paymentMethod: paymentMethod })
      })
      .then(response => response.json())
      .then(data => {
          if (data.success) {
              localStorage.removeItem('cart');
              alert('Order placed successfully');
              checkoutModal.style.display = "none";
          } else {
              alert('Failed to place order: ' + data.message);
          }
      })
      .catch(error => {
          console.error('Error:', error);
          alert('An error occurred while placing your order.');
      });
  }

  updateCartItems();
});
    </script>

</body>
</html>
